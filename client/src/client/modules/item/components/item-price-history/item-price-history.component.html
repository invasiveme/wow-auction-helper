<ng-container *ngIf="isActiveTab">
  <ng-container *ngIf="isInitiated && !isLoading ; else loadingTemplate">
    <form [formGroup]="form" *ngIf="auctionItem.source?.recipe?.all">
      <mat-form-field>
        <mat-select formControlName="recipe" placeholder="Crafting cost by recipe">
          <mat-option>No recipe is selected</mat-option>
          <mat-option *ngFor="let recipe of auctionItem.source?.recipe?.all" [value]="recipe">
            {{recipe.name}} - {{recipe.rank}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </form>
    <em>
      Note: The prices here might deviate, from what you see in external tables.
      This data is updated right now, unlike the "external" which has some delay due to calculation time.
    </em>

    <h6>Hourly changes for the past 14 days</h6>
    <mat-list dense class="horizontal-item-list mb-3" *ngIf="stats">
      <mat-list-item>
        <div mat-line [style]="{color: theme.accentColorCode}">
          Past 12 hours
        </div>
        <div mat-line>
          <span [style]="{color: theme.primaryColorCode}">Avg change</span>
          {{ stats.past12Hours.price.trend | gold }}
          <span [style]="{color: theme.primaryColorCode}">Avg price</span>
          {{ stats.past12Hours.price.avg | gold }}
        </div>
        <div mat-line>
          <span [style]="{color: theme.warnColorCode}">Avg change</span>
          {{ stats.past12Hours.quantity.trend | number }}
          <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
          {{ stats.past12Hours.quantity.avg | number }}
        </div>
      </mat-list-item>
      <mat-list-item>
        <div mat-line [style]="{color: theme.accentColorCode}">
          Past 24 hours
        </div>
        <div mat-line>
          <span [style]="{color: theme.primaryColorCode}">Avg change</span>
          {{ stats.past24Hours.price.trend | gold }}
          <span [style]="{color: theme.primaryColorCode}">Avg price</span>
          {{ stats.past24Hours.price.avg | gold }}
        </div>
        <div mat-line>
          <span [style]="{color: theme.warnColorCode}">Avg change</span>
          {{ stats.past24Hours.quantity.trend | number }}
          <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
          {{ stats.past24Hours.quantity.avg | number }}
        </div>
      </mat-list-item>
      <mat-list-item>
        <div mat-line [style]="{color: theme.accentColorCode}">
          Past 7 days
        </div>
        <div mat-line>
          <span [style]="{color: theme.primaryColorCode}">Avg change</span>
          {{ stats.past7Days.price.trend | gold }}
          <span [style]="{color: theme.primaryColorCode}">Avg price</span>
          {{ stats.past7Days.price.avg | gold }}
        </div>
        <div mat-line>
          <span [style]="{color: theme.warnColorCode}">Avg change</span>
          {{ stats.past7Days.quantity.trend | number }}
          <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
          {{ stats.past7Days.quantity.avg | number }}
        </div>
      </mat-list-item>
      <mat-list-item>
        <div mat-line [style]="{color: theme.accentColorCode}">
          Past 14 days
        </div>
        <div mat-line>
          <span [style]="{color: theme.primaryColorCode}">Avg change</span>
          {{ stats.past14Days.price.trend | gold }}
          <span [style]="{color: theme.primaryColorCode}">Avg price</span>
          {{ stats.past14Days.price.avg | gold }}
        </div>
        <div mat-line>
          <span [style]="{color: theme.warnColorCode}">Avg change</span>
          {{ stats.past14Days.quantity.trend | number }}
          <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
          {{ stats.past14Days.quantity.avg | number }}
        </div>
      </mat-list-item>
    </mat-list>
      <mat-tab-group class="mb-3">
        <mat-tab label="Chart">
          <wah-highcharts
                  title="Hourly prices and quantity for the past 14 days"
                  [series]="hourlyChart"
                  [(update)]="updateDailyChart"
          >
          </wah-highcharts>

        </mat-tab>
        <mat-tab label="Table">
          <wah-data-table
                  [columns]="fourteenDayByHourTable.columns"
                  [data]="fourteenDayByHourTable.data">
          </wah-data-table>
        </mat-tab>
      </mat-tab-group>


    <ng-container *ngIf="groupedByDateTable.data.length > 0">
      <h6>Daily changes for the past 6 months</h6>
      <mat-list dense class="horizontal-item-list mb-3" *ngIf="statsDaily">
        <mat-list-item>
          <div mat-line [style]="{color: theme.accentColorCode}">
            Past 7 days
          </div>
          <div mat-line>
            <span [style]="{color: theme.primaryColorCode}">Avg change</span>
            {{ statsDaily.past7Days.price.trend | gold }}
            <span [style]="{color: theme.primaryColorCode}">Avg price</span>
            {{ statsDaily.past7Days.price.avg | gold }}
          </div>
          <div mat-line>
            <span [style]="{color: theme.warnColorCode}">Avg change</span>
            {{ statsDaily.past7Days.quantity.trend | number }}
            <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
            {{ statsDaily.past7Days.quantity.avg | number }}
          </div>
        </mat-list-item>
        <mat-list-item>
          <div mat-line [style]="{color: theme.accentColorCode}">
            Past 14 days
          </div>
          <div mat-line>
            <span [style]="{color: theme.primaryColorCode}">Avg change</span>
            {{ statsDaily.past14Days.price.trend | gold }}
            <span [style]="{color: theme.primaryColorCode}">Avg price</span>
            {{ statsDaily.past14Days.price.avg | gold }}
          </div>
          <div mat-line>
            <span [style]="{color: theme.warnColorCode}">Avg change</span>
            {{ statsDaily.past14Days.quantity.trend | number }}
            <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
            {{ statsDaily.past14Days.quantity.avg | number }}
          </div>
        </mat-list-item>
        <mat-list-item>
          <div mat-line [style]="{color: theme.accentColorCode}">
            Past month
          </div>
          <div mat-line>
            <span [style]="{color: theme.primaryColorCode}">Avg change</span>
            {{ statsDaily.past30Days.price.trend | gold }}
            <span [style]="{color: theme.primaryColorCode}">Avg price</span>
            {{ statsDaily.past30Days.price.avg | gold }}
          </div>
          <div mat-line>
            <span [style]="{color: theme.warnColorCode}">Avg change</span>
            {{ statsDaily.past30Days.quantity.trend | number }}
            <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
            {{ statsDaily.past30Days.quantity.avg | number }}
          </div>
        </mat-list-item>
        <mat-list-item>
          <div mat-line [style]="{color: theme.accentColorCode}">
            Past 3 months
          </div>
          <div mat-line>
            <span [style]="{color: theme.primaryColorCode}">Avg change</span>
            {{ statsDaily.past90Days.price.trend | gold }}
            <span [style]="{color: theme.primaryColorCode}">Avg price</span>
            {{ statsDaily.past90Days.price.avg | gold }}
          </div>
          <div mat-line>
            <span [style]="{color: theme.warnColorCode}">Avg change</span>
            {{ statsDaily.past90Days.quantity.trend | number }}
            <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
            {{ statsDaily.past90Days.quantity.avg | number }}
          </div>
        </mat-list-item>
        <mat-list-item>
          <div mat-line [style]="{color: theme.accentColorCode}">
            Past 6 months
          </div>
          <div mat-line>
            <span [style]="{color: theme.primaryColorCode}">Avg change</span>
            {{ statsDaily.past180Days.price.trend | gold }}
            <span [style]="{color: theme.primaryColorCode}">Avg price</span>
            {{ statsDaily.past180Days.price.avg | gold }}
          </div>
          <div mat-line>
            <span [style]="{color: theme.warnColorCode}">Avg change</span>
            {{ statsDaily.past180Days.quantity.trend | number }}
            <span [style]="{color: theme.warnColorCode}">Avg quantity</span>
            {{ statsDaily.past180Days.quantity.avg | number }}
          </div>
        </mat-list-item>
      </mat-list>
      <mat-tab-group>
        <mat-tab label="Chart">
          <wah-highcharts
                  title="Daily prices and quantity"
                  [series]="dailyChart"
                  [(update)]="updateDailyChart"
                  [xAxis]="xAxis"
                  (chartInstance)="setChartInstance($event)"
          >
          </wah-highcharts>
        </mat-tab>
        <mat-tab label="Table">
          <wah-data-table
                  [columns]="groupedByDateTable.columns"
                  [data]="groupedByDateTable.data">
          </wah-data-table>
        </mat-tab>
      </mat-tab-group>
    </ng-container>
  </ng-container>

  <ng-template #loadingTemplate>
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    Loading historical price data. This might take a couple seconds.
  </ng-template>
</ng-container>
